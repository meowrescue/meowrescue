import{c as e,r as s,u as a,j as t,B as r,X as i,I as c}from"./main.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o=e("MessageSquareText",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M13 8H7",key:"14i4kc"}],["path",{d:"M17 12H7",key:"16if0g"}]]),n=()=>{const[e,n]=s.useState(!1),[l,h]=s.useState(!0),[m,d]=s.useState([]),[g,f]=s.useState(""),[u,x]=s.useState(null),p=a();s.useEffect((()=>{const e=p.pathname.startsWith("/admin");h(!e)}),[p]),s.useEffect((()=>{if(!e||u)return;(async()=>{try{const e=localStorage.getItem("chatSessionId");if(e){x(e);const{data:s,error:a}=await supabase.from("chat_messages").select("*").eq("chat_session_id",e).order("created_at",{ascending:!0});if(a)throw a;d(s||[])}else{const{data:e,error:s}=await supabase.from("chat_sessions").insert([{status:"active"}]).select().single();if(s)throw s;const a=e.id;x(a),localStorage.setItem("chatSessionId",a)}}catch(e){console.error("Error initializing chat:",e)}})()}),[e,u]),s.useEffect((()=>{if(!u)return;const e=supabase.channel(`chat-session-${u}-updates`).on("postgres_changes",{event:"*",schema:"public",table:"chat_messages",filter:`chat_session_id=eq.${u}`},(e=>{console.log("Chat message update received:",e),d((s=>[...s,e.new]))})).subscribe();return()=>{e.unsubscribe()}}),[u]);const w=()=>{n(!e)};return t.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:l&&(e?t.jsxs("div",{className:"w-[400px] h-[500px] bg-white rounded-lg shadow-lg overflow-hidden flex flex-col animate-in slide-in-from-bottom-5",children:[t.jsxs("div",{className:"bg-meow-primary p-3 flex justify-between items-center text-white",children:[t.jsx("h3",{className:"font-bold",children:"Chat with Meow Rescue"}),t.jsx(r,{variant:"ghost",onClick:w,className:"hover:bg-meow-primary/30 p-1 h-auto text-white",children:t.jsx(i,{className:"h-5 w-5"})})]}),t.jsx("div",{className:"flex-1 p-3 overflow-y-auto flex flex-col gap-2",children:0===m.length?t.jsx("p",{className:"text-gray-500 text-center",children:"No messages yet. Start the conversation!"}):m.map(((e,s)=>t.jsxs("div",{className:"p-2 rounded-lg "+(e.is_admin?"bg-meow-primary/20 self-start":"bg-gray-100 self-end"),children:[t.jsx("p",{className:"text-sm",children:e.content}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(e.created_at).toLocaleTimeString()})]},s)))}),t.jsxs("div",{className:"p-3 border-t border-gray-200 flex gap-2",children:[t.jsx(c,{value:g,onChange:e=>f(e.target.value),placeholder:"Type your message...",className:"flex-1"}),t.jsx(r,{onClick:async()=>{if(g.trim()&&u)try{const{data:e,error:s}=await supabase.from("chat_messages").insert([{chat_session_id:u,content:g,is_admin:!1}]);if(s)throw s;f("")}catch(e){console.error("Error sending message:",e)}},className:"bg-meow-primary hover:bg-meow-primary/90",children:"Send"})]})]}):t.jsx(r,{onClick:w,className:"h-12 w-12 rounded-full bg-meow-primary hover:bg-meow-primary/90 flex items-center justify-center",children:t.jsx(o,{className:"h-6 w-6 text-white"})}))})};export{n as default};
