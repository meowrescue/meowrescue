import{c as e,r as s,u as t,s as a,j as r,B as i,X as c,I as n}from"./main-DgSpPjg3.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o=e("MessageSquareText",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M13 8H7",key:"14i4kc"}],["path",{d:"M17 12H7",key:"16if0g"}]]),l=()=>{const[e,l]=s.useState(!1),[h,m]=s.useState(!0),[d,f]=s.useState([]),[x,g]=s.useState(""),[u,p]=s.useState(null),w=t();s.useEffect((()=>{const e=w.pathname.startsWith("/admin");m(!e)}),[w]),s.useEffect((()=>{if(!e||u)return;(async()=>{try{const e=localStorage.getItem("chatSessionId");if(e){p(e);const{data:s,error:t}=await a.from("chat_messages").select("*").eq("chat_session_id",e).order("created_at",{ascending:!0});if(t)throw t;f(s||[])}else{const{data:e,error:s}=await a.from("chat_sessions").insert([{status:"active"}]).select().single();if(s)throw s;const t=e.id;p(t),localStorage.setItem("chatSessionId",t)}}catch(e){}})()}),[e,u]),s.useEffect((()=>{if(!u)return;const e=a.channel(`chat-session-${u}-updates`).on("postgres_changes",{event:"*",schema:"public",table:"chat_messages",filter:`chat_session_id=eq.${u}`},(e=>{f((s=>[...s,e.new]))})).subscribe();return()=>{e.unsubscribe()}}),[u]);const y=()=>{l(!e)};return r.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:h&&(e?r.jsxs("div",{className:"w-[400px] h-[500px] bg-white rounded-lg shadow-lg overflow-hidden flex flex-col animate-in slide-in-from-bottom-5",children:[r.jsxs("div",{className:"bg-meow-primary p-3 flex justify-between items-center text-white",children:[r.jsx("h3",{className:"font-bold",children:"Chat with Meow Rescue"}),r.jsx(i,{variant:"ghost",onClick:y,className:"hover:bg-meow-primary/30 p-1 h-auto text-white",children:r.jsx(c,{className:"h-5 w-5"})})]}),r.jsx("div",{className:"flex-1 p-3 overflow-y-auto flex flex-col gap-2",children:0===d.length?r.jsx("p",{className:"text-gray-500 text-center",children:"No messages yet. Start the conversation!"}):d.map(((e,s)=>r.jsxs("div",{className:"p-2 rounded-lg "+(e.is_admin?"bg-meow-primary/20 self-start":"bg-gray-100 self-end"),children:[r.jsx("p",{className:"text-sm",children:e.content}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(e.created_at).toLocaleTimeString()})]},s)))}),r.jsxs("div",{className:"p-3 border-t border-gray-200 flex gap-2",children:[r.jsx(n,{value:x,onChange:e=>g(e.target.value),placeholder:"Type your message...",className:"flex-1"}),r.jsx(i,{onClick:async()=>{if(x.trim()&&u)try{const{data:e,error:s}=await a.from("chat_messages").insert([{chat_session_id:u,content:x,is_admin:!1}]);if(s)throw s;g("")}catch(e){}},className:"bg-meow-primary hover:bg-meow-primary/90",children:"Send"})]})]}):r.jsx(i,{onClick:y,className:"h-12 w-12 rounded-full bg-meow-primary hover:bg-meow-primary/90 flex items-center justify-center",children:r.jsx(o,{className:"h-6 w-6 text-white"})}))})};export{l as default};
