import{jsx as e,jsxs as t}from"react/jsx-runtime";import{useState as r,useEffect as a}from"react";import{c as s,B as o,X as i,I as c}from"./entry-server.js";import{useLocation as m}from"react-router-dom";import"react-dom/server";import"react-router-dom/server.mjs";import"react-fast-compare";import"invariant";import"shallowequal";import"@tanstack/react-query";import"@supabase/supabase-js";import"react-dom";import"@floating-ui/react-dom";import"clsx";import"tailwind-merge";import"class-variance-authority";import"next-themes";import"sonner";import"aria-hidden";import"react-remove-scroll";import"use-sync-external-store/shim";import"framer-motion";import"date-fns";import"react-hook-form";import"@hookform/resolvers/zod";import"zod";import"react-day-picker";import"recharts";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n=s("MessageSquareText",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M13 8H7",key:"14i4kc"}],["path",{d:"M17 12H7",key:"16if0g"}]]),l=()=>{const[s,l]=r(!1),[d,h]=r(!0),[p,g]=r([]),[f,u]=r(""),[w,y]=r(null),b=m();a((()=>{const e=b.pathname.startsWith("/admin");h(!e)}),[b]),a((()=>{if(!s||w)return;(async()=>{try{const e=localStorage.getItem("chatSessionId");if(e){y(e);const{data:t,error:r}=await supabase.from("chat_messages").select("*").eq("chat_session_id",e).order("created_at",{ascending:!0});if(r)throw r;g(t||[])}else{const{data:e,error:t}=await supabase.from("chat_sessions").insert([{status:"active"}]).select().single();if(t)throw t;const r=e.id;y(r),localStorage.setItem("chatSessionId",r)}}catch(e){console.error("Error initializing chat:",e)}})()}),[s,w]),a((()=>{if(!w)return;const e=supabase.channel(`chat-session-${w}-updates`).on("postgres_changes",{event:"*",schema:"public",table:"chat_messages",filter:`chat_session_id=eq.${w}`},(e=>{console.log("Chat message update received:",e),g((t=>[...t,e.new]))})).subscribe();return()=>{e.unsubscribe()}}),[w]);const x=()=>{l(!s)};return e("div",{className:"fixed bottom-4 right-4 z-50",children:d&&(s?t("div",{className:"w-[400px] h-[500px] bg-white rounded-lg shadow-lg overflow-hidden flex flex-col animate-in slide-in-from-bottom-5",children:[t("div",{className:"bg-meow-primary p-3 flex justify-between items-center text-white",children:[e("h3",{className:"font-bold",children:"Chat with Meow Rescue"}),e(o,{variant:"ghost",onClick:x,className:"hover:bg-meow-primary/30 p-1 h-auto text-white",children:e(i,{className:"h-5 w-5"})})]}),e("div",{className:"flex-1 p-3 overflow-y-auto flex flex-col gap-2",children:0===p.length?e("p",{className:"text-gray-500 text-center",children:"No messages yet. Start the conversation!"}):p.map(((r,a)=>t("div",{className:"p-2 rounded-lg "+(r.is_admin?"bg-meow-primary/20 self-start":"bg-gray-100 self-end"),children:[e("p",{className:"text-sm",children:r.content}),e("p",{className:"text-xs text-gray-500 mt-1",children:new Date(r.created_at).toLocaleTimeString()})]},a)))}),t("div",{className:"p-3 border-t border-gray-200 flex gap-2",children:[e(c,{value:f,onChange:e=>u(e.target.value),placeholder:"Type your message...",className:"flex-1"}),e(o,{onClick:async()=>{if(f.trim()&&w)try{const{data:e,error:t}=await supabase.from("chat_messages").insert([{chat_session_id:w,content:f,is_admin:!1}]);if(t)throw t;u("")}catch(e){console.error("Error sending message:",e)}},className:"bg-meow-primary hover:bg-meow-primary/90",children:"Send"})]})]}):e(o,{onClick:x,className:"h-12 w-12 rounded-full bg-meow-primary hover:bg-meow-primary/90 flex items-center justify-center",children:e(n,{className:"h-6 w-6 text-white"})}))})};export{l as default};
